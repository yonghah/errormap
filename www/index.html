<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8' />
    <title></title>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
    <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.40.0/mapbox-gl.js'></script>
    <script src="https://d3js.org/d3.v4.min.js"></script>

    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.40.0/mapbox-gl.css' rel='stylesheet' />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <style>
        body { margin:0; padding:0; }
        #map { position:absolute; top:0; bottom:0; width:100%; }
    </style>
</head>
<body>

<style>
    .title {
        position: absolute;
        top: 0px;
        left: 0px;
        margin: 10px;
        width:200px;
    }
    .legend-key {
        display: inline-block;
        border-radius: 20%;
        width: 10px;
        height: 10px;
        margin-right: 5px;
    }
</style>

<div id='map'></div>
<div class='title panel panel-primary'>
  <div class="panel-heading">Choropleth map <br> with errors</div>
    <div class="panel-body">
      Estimate is expressed a color filled in the polygon.
      Upper confidence limt and lower confidence is expressed with alternating
      colors of the polygon boundary.
    </div>
</div>
<script>
mapboxgl.accessToken = 'pk.eyJ1IjoiYWhnbm95IiwiYSI6ImZIcGRiZjgifQ.pL1SaB8gHyl-L2yolSl5Qw';
var map = new mapboxgl.Map({
    container: 'map',
    style: 'mapbox://styles/mapbox/light-v9',
    center: [-84.93, 44.51],
    zoom: 6.7
});

var color1 = "#c9cfd8";
var color2 = "#073682";
var line_width_min = 1;
var line_width_max = 10;
var dash_gap = 1.2;

map.addControl(new mapboxgl.NavigationControl());
map.on('load', function() {
    map.addSource('data-source', {
        type: 'vector',
        url:'mapbox://ahgnoy.detsm656'
    });

    map.addLayer({
        'id': 'fill-layer',
        'type': 'fill',
        'source': 'data-source',
        "source-layer": "michigan-4qtdrh",
        'paint': {
            'fill-color': {
                'property': 'mean',
                'type': 'exponential',
                "stops": [
                    [40, color1], 
                    [210, color2] 
               ]
            }
        }
    });
    map.addLayer({
        'id': 'c1-layer',
        'type': 'line',
        'source': 'data-source',
        "source-layer": "michigan-4qtdrh",
        'paint': {
            'line-color': {
                'property': 'c1',
                'type': 'exponential',
                "stops": [
                    [40, color1], 
                    [210, color2] 
               ]
            },
          'line-width': {
            'stops': [[5, line_width_min], [10, line_width_max]]
          
          },
          'line-offset': {
            'stops': [[5, line_width_min*0.5], [10, line_width_max*0.5]]
          
          }
        }
    });
    map.addLayer({
        'id': 'c2-layer',
        'type': 'line',
        'source': 'data-source',
        "source-layer": "michigan-4qtdrh",
        'paint': {
            'line-color': {
                'property': 'c2',
                'type': 'exponential',
                "stops": [
                    [40, color1], 
                    [210, color2] 
               ]
            },
          'line-width': {
            'stops': [[5, line_width_min], [10, line_width_max]]
          
          },
          'line-offset': {
            'stops': [[5, line_width_min*0.5], [10, line_width_max*0.5]]
          
          },
          'line-dasharray': [dash_gap, dash_gap]
        }
    });
  var popup = new mapboxgl.Popup({
      closeButton: false,
      closeOnClick: false
  });

  map.on('click', 'fill-layer', function(e) {
      console.log(e);
      popup.setLngLat(e.lngLat)
          .setHTML(
            "estimate:"+e.features[0].properties.mean + "<br>" +
            "upper CI:"+e.features[0].properties.c2.toFixed(2)+ "<br>" +
            "lower CI:"+e.features[0].properties.c1.toFixed(2)
          )
          .addTo(map);
  });
  map.on('mouseenter', 'fill-layer', function() {
      map.getCanvas().style.cursor = 'pointer';
  });
  map.on('mouseleave', 'fill-layer', function() {
      popup.remove();
      map.getCanvas().style.cursor = '';
  });

});
</script>
</body>
</html>
